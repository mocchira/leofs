
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LeoProject makes LeoFS, which is an open source distributed object storage system and a highly available, distributed, eventually consistent storage system. LeoFS is supporting the following features:Multi-protocol Support - S3-API, REST-API and NFS v3, Large Object Support, Multi Data Center Replication and others.">
      
      
      
        <meta name="author" content="LeoProject">
      
      
        <link rel="shortcut icon" href="../../../favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.1">
    
    
      
        <title>Data Operations - LeoFS Documentation</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application-4d0d3f2fbf.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../../.." title="LeoFS Documentation" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  For Administrators
                </span>
              
                <span class="md-header-nav__parent">
                  System Operations
                </span>
              
            
            Data Operations
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/leo-project/leofs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    LeoFS Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/leo-project/leofs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../whats_new/" title="What's New?" class="md-nav__link">
      What's New?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/quick/" title="Quick Installation and Setup" class="md-nav__link">
      Quick Installation and Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/cluster/" title="Building a LeoFS' cluster with Ansible" class="md-nav__link">
      Building a LeoFS' cluster with Ansible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concept and Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concept and Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/README/" title="LeoFS' Architecture" class="md-nav__link">
      LeoFS' Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_gateway/" title="LeoGateway's Architecture" class="md-nav__link">
      LeoGateway's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_storage/" title="LeoStorage's Architecture" class="md-nav__link">
      LeoStorage's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_manager/" title="LeoManager's Architecture" class="md-nav__link">
      LeoManager's Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/planning_for_production/" title="Planning for Production" class="md-nav__link">
      Planning for Production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/supported_platforms/" title="Supported Platforms" class="md-nav__link">
      Supported Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/hardware_requirements/" title="Hardware Requirements" class="md-nav__link">
      Hardware Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/network_config/" title="Network Configurations" class="md-nav__link">
      Network Configurations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Settings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2">
        Settings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/cluster/" title="Cluster Settings" class="md-nav__link">
      Cluster Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_manager/" title="LeoManager Settings" class="md-nav__link">
      LeoManager Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_storage/" title="LeoStroage Settings" class="md-nav__link">
      LeoStroage Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_gateway/" title="LeoGateway Settings" class="md-nav__link">
      LeoGateway Settings
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-5-3">
        Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/s3/" title="S3-API" class="md-nav__link">
      S3-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/rest/" title="REST-API" class="md-nav__link">
      REST-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/nfs_v3/" title="NFS v3" class="md-nav__link">
      NFS v3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4" checked>
    
    <label class="md-nav__link" for="nav-5-4">
      System Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-5-4">
        System Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../flow/" title="Operation Flow" class="md-nav__link">
      Operation Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../s3/" title="S3-API related Operations" class="md-nav__link">
      S3-API related Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster/" title="Cluster Operations" class="md-nav__link">
      Cluster Operations
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Data Operations
      </label>
    
    <a href="./" title="Data Operations" class="md-nav__link md-nav__link--active">
      Data Operations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" title="Storage Architecture" class="md-nav__link">
    Storage Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append-only-for-content-avs" title="Append-Only for Content (AVS)" class="md-nav__link">
    Append-Only for Content (AVS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kvs-for-metadata" title="KVS for Metadata" class="md-nav__link">
    KVS for Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-for-async-operations" title="Queue for Async Operations" class="md-nav__link">
    Queue for Async Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" title="File Structure" class="md-nav__link">
    File Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compaction" title="Compaction" class="md-nav__link">
    Compaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compaction_1" title="Compaction" class="md-nav__link">
    Compaction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-transition" title="State Transition" class="md-nav__link">
    State Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" title="Diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover-objects" title="Recover Objects" class="md-nav__link">
    Recover Objects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commands_1" title="Commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi_dc_replication/" title="Multi Data Center Replication" class="md-nav__link">
      Multi Data Center Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/" title="Others" class="md-nav__link">
      Others
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      System Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="6">
      <label class="md-nav__title" for="nav-5-5">
        System Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/log_management/" title="Log Management" class="md-nav__link">
      Log Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/leo_manager/" title="LeoManager's Maintenance" class="md-nav__link">
      LeoManager's Maintenance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/monitoring/" title="System Monitoring" class="md-nav__link">
      System Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/migration/" title="System Migration" class="md-nav__link">
      System Migration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/backup_and_restore/" title="Backup and Restore" class="md-nav__link">
      Backup and Restore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/integration/" title="System Integration" class="md-nav__link">
      System Integration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index_of_commands/" title="Index of LeoFS' Commands" class="md-nav__link">
      Index of LeoFS' Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../benchmark/README/" title="Benchmark" class="md-nav__link">
      Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      FAQ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        FAQ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/fundamentals/" title="LeoFS Fundamentals" class="md-nav__link">
      LeoFS Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/limits/" title="LeoFS Limits" class="md-nav__link">
      LeoFS Limits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/administration/" title="LeoFS Administration" class="md-nav__link">
      LeoFS Administration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../production_checklist/README/" title="Production Checklist" class="md-nav__link">
      Production Checklist
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" title="Storage Architecture" class="md-nav__link">
    Storage Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append-only-for-content-avs" title="Append-Only for Content (AVS)" class="md-nav__link">
    Append-Only for Content (AVS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kvs-for-metadata" title="KVS for Metadata" class="md-nav__link">
    KVS for Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-for-async-operations" title="Queue for Async Operations" class="md-nav__link">
    Queue for Async Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" title="File Structure" class="md-nav__link">
    File Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compaction" title="Compaction" class="md-nav__link">
    Compaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compaction_1" title="Compaction" class="md-nav__link">
    Compaction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-transition" title="State Transition" class="md-nav__link">
    State Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" title="Diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover-objects" title="Recover Objects" class="md-nav__link">
    Recover Objects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commands_1" title="Commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/leo-project/leofs/edit/master/docs/admin/system_operations/data.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="data-operations">Data Operations<a class="headerlink" href="#data-operations" title="Permanent link">&para;</a></h1>
<p>This section provides information to operate data stored in LeoFS as well as the prior knowledge that give you better understanding about what will happen behind the scene when you invoke a command for a data operation.</p>
<h2 id="storage-architecture">Storage Architecture<a class="headerlink" href="#storage-architecture" title="Permanent link">&para;</a></h2>
<p>A brief introduction how LeoFS organize data into actual OS files.</p>
<h3 id="append-only-for-content-avs">Append-Only for Content (AVS)<a class="headerlink" href="#append-only-for-content-avs" title="Permanent link">&para;</a></h3>
<p>Once a PUT/DELETE remote procedure call (<strong>RPC</strong>) arrives on leo_storage, leo_object_storage appends new blocks including the object information such as the key, data itself and also various associated metadata to the end of a file. This Append-Only file we call <strong>AVS</strong> is referenced when retrieving the data through GET RPCs. With its inherent nature of the Append-Only file, a compaction process is needed to clean up the orphaned space in an AVS.</p>
<h3 id="kvs-for-metadata">KVS for Metadata<a class="headerlink" href="#kvs-for-metadata" title="Permanent link">&para;</a></h3>
<p>After having succeeded in appending new blocks to an AVS, then leo_object_storage updates a corresponding <strong>KVS</strong> file with the key and its associated metadata (same information stored in the AVS except the data itself) and its offset where the new blocks stored in AVS as a value. This KVS file is referenced when retrieving the data/metadata through GET/HEAD RPCs.</p>
<h3 id="queue-for-async-operations">Queue for Async Operations<a class="headerlink" href="#queue-for-async-operations" title="Permanent link">&para;</a></h3>
<p>Some data can be stored into a <strong>Queue</strong> for processing later in case</p>
<ul>
<li>A PUT/DELETE operation failed.</li>
<li>A Multi DC Replication (<strong>MDCR</strong>) failed.</li>
<li>rebalance/recover-(file|node|cluster) invoked through leofs-adm.</li>
</ul>
<h3 id="file-structure">File Structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h3>
<p>Multiple AVS/KVS pairs can be placed on one node to enable LeoFS handling as much use cases and hardware requirements as possible.</p>
<ul>
<li>Container : AVS/KVS pair = 1 : N<ul>
<li>Multiple AVS/KVS pairs can be stored under one OS directory (We call it <strong>Container</strong>).</li>
<li>N can be specified through leo_storage.conf.</li>
<li>How to choose optimal N<ul>
<li>As a Compaction is executed per AVS/KVS pair, at least the size of a AVS/KVS pair is needed to run Compaction so that the larger N, the less disk space LeoFS uses for Compaction.</li>
<li>However the larger N, the more disk seeks LeoFS suffers.</li>
<li>Tha said, the optimal N is determined by setting the largest value that doesn't affect the online throughput you would expect.</li>
</ul>
</li>
</ul>
</li>
<li>Node : Container = 1 : N<ul>
<li>Each Container can be stored under a different OS directory.</li>
<li>N can be specified through leo_storage.conf.</li>
<li>Setting N &gt; 1 can be useful when there are multiple JBOD disks on the node. The one JBOD disk array can be map to the one container.</li>
</ul>
</li>
</ul>
<h3 id="compaction">Compaction<a class="headerlink" href="#compaction" title="Permanent link">&para;</a></h3>
<p>This section provides information about what/how Compaction can affect the online performance. </p>
<ul>
<li>Parallelism<ul>
<li>A Compaction can be executed across multiple AVS/KVS pairs in parallel.</li>
<li>The number of compaction processes can be specified through an argument of leofs-adm.</li>
<li>Increasing the number can be useful when the load coming from online is relatively low and want the compaction process to boost as much as possible.</li>
<li>Be careful that too much number can make the compaction process slow down.</li>
</ul>
</li>
<li>Concurrent with any operation coming from online.<ul>
<li>GET/HEAD never be blocked by the Compaction.</li>
<li>PUT/DELETE can be blocked while a Compaction is processing the tail part of an AVS.</li>
<li>Given that the above limitation, We would recommend suspending a node you are supposed to run a Compaction if your LeoFS cluster handles write intensive workload.</li>
</ul>
</li>
</ul>
<h2 id="compaction_1">Compaction<a class="headerlink" href="#compaction_1" title="Permanent link">&para;</a></h2>
<p>As described at the previous section, A compaction process is needed to remove logical deleted objects and its corresponding metadatas.</p>
<h3 id="state-transition">State Transition<a class="headerlink" href="#state-transition" title="Permanent link">&para;</a></h3>
<p><img alt="State Transition" src="http://leo-project.net/leofs/docs/_images/leofs-compaction-state-transition.png" /></p>
<h3 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">&para;</a></h3>
<p>Commands related to Compaction as well as Disk Usage.</p>
<table>
<thead>
<tr>
<th>Shell</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Compaction Commands</strong></td>
<td></td>
</tr>
<tr>
<td>leofs-adm compact-start \&lt;storage-node> (all|\&lt;num-of-targets>) [\&lt;num-of-compaction-proc>]</td>
<td>Start Compaction (Transfer its state to <strong>running</strong>).<p>num-of-targets: How many AVS/KVS pairs are compacted.<p>num-of-compaction-pro: How many processes are run in parallel.</td>
</tr>
<tr>
<td>leofs-adm compact-suspend \&lt;storage-node></td>
<td>Suspend Compaction (Transfer its state to <strong>suspend</strong> from running).</td>
</tr>
<tr>
<td>leofs-adm compact-resume \&lt;storage-node></td>
<td>Resume Compaction (Transfer its state to <strong>running</strong> from suspend).</td>
</tr>
<tr>
<td>leofs-adm compact-status \&lt;storage-node></td>
<td>See the Current Compaction Status.</td>
</tr>
<tr>
<td>leofs-adm diagnose-start \&lt;storage-node></td>
<td>Start Diagnose (Not actually doing Compaction but scanning all AVS/KVS pairs and reporting what objects/metadatas exist as a file).</td>
</tr>
<tr>
<td><strong>Disk Usage</strong></td>
<td></td>
</tr>
<tr>
<td>leofs-adm du \&lt;storage-node></td>
<td>See the Current Disk Usage.</td>
</tr>
<tr>
<td>leofs-adm du detail \&lt;storage-node></td>
<td>See the Current Disk Usage in detail.</td>
</tr>
</tbody>
</table>
<p>Examples.</p>
<ul>
<li>compact-start</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## All AVS/KVS pairs on storage_0@127.0.0.1 will be compacted with 3 concurrent processes</span>
<span class="c1">## (default concurrency is 3)</span>
$ leofs-adm compact-start storage_0@127.0.0.1 all
OK

<span class="c1">## 5 AVS/KVS pairs on storage_0@127.0.0.1 will be compacted with 2 concurrent processes</span>
$ leofs-adm compact-start storage_0@127.0.0.1 <span class="m">5</span> <span class="m">2</span>
OK
</pre></div>
</td></tr></table>

<ul>
<li>compact-suspend</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm compact-suspend storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<ul>
<li>compact-resume</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm compact-resume storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<ul>
<li>compact-status</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm compact-status storage_0@127.0.0.1
        current status: running
 last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
         total targets: <span class="m">64</span>
  <span class="c1"># of pending targets: 5</span>
  <span class="c1"># of ongoing targets: 3</span>
  <span class="c1"># of out of targets : 56</span>
</pre></div>
</td></tr></table>

<ul>
<li>diagnose-start</li>
<li>See also: <strong>diagnosis-log format</strong> to understand the output log format</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm diagnose-start storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<ul>
<li>du</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm du storage_0@127.0.0.1
 active number of objects: <span class="m">19968</span>
  total number of objects: <span class="m">39936</span>
   active size of objects: <span class="m">198256974</span>.0
    total size of objects: <span class="m">254725020</span>.0
     ratio of active size: <span class="m">77</span>.83%
    last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
      last compaction end: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:55 +0900
</pre></div>
</td></tr></table>

<ul>
<li>du detail</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm du detail storage_0@127.0.0.1
<span class="o">[</span>du<span class="o">(</span>storage stats<span class="o">)]</span>
                file path: /home/leofs/dev/leofs/package/leofs/storage/avs/object/0.avs
 active number of objects: <span class="m">320</span>
  total number of objects: <span class="m">640</span>
   active size of objects: <span class="m">3206378</span>.0
    total size of objects: <span class="m">4082036</span>.0
     ratio of active size: <span class="m">78</span>.55%
    last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
      last compaction end: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:55 +0900
.
.
.
                file path: /home/leofs/dev/leofs/package/leofs/storage/avs/object/63.avs
 active number of objects: <span class="m">293</span>
  total number of objects: <span class="m">586</span>
   active size of objects: <span class="m">2968909</span>.0
    total size of objects: <span class="m">3737690</span>.0
     ratio of active size: <span class="m">79</span>.43%
    last compaction start: ____-__-__ __:__:__
      last compaction end: ____-__-__ __:__:__
</pre></div>
</td></tr></table>

<h3 id="diagnosis">Diagnosis<a class="headerlink" href="#diagnosis" title="Permanent link">&para;</a></h3>
<p>This section explains the file format generated by <code class="codehilite">leofs-adm diagnose-start</code> in detail.</p>
<p>Exmaples.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>------+------------------------------------------+------------------------------------------------------------+-----------+------------+------------------+--------------------------+----
Offset<span class="p">|</span> RING<span class="err">&#39;</span>s address-id                        <span class="p">|</span> Filename                                                   <span class="p">|</span> Child num <span class="p">|</span> File Size  <span class="p">|</span> Unixtime         <span class="p">|</span> Localtime                <span class="p">|</span>del?
------+------------------------------------------+------------------------------------------------------------+-----------+------------+------------------+--------------------------+----
<span class="m">194</span>     <span class="m">296754181484029444656944009564610621293</span>   photo/leo_redundant_manager/Makefile                             <span class="m">0</span>       <span class="m">2034</span>        <span class="m">1413348050768344</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:40:50 +0900   <span class="m">0</span>
<span class="m">2400</span>    <span class="m">185993533055981727582172380494809056426</span>   photo/leo_redundant_manager/ebin/leo_redundant_manager.beam      <span class="m">0</span>       <span class="m">24396</span>       <span class="m">1413348050869454</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:40:50 +0900   <span class="m">0</span>
<span class="m">38446</span>   <span class="m">53208912738248114804281793572563205919</span>    photo/leo_rpc/.git/refs/remotes/origin/HEAD                      <span class="m">0</span>       <span class="m">33</span>          <span class="m">1413348057441546</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:40:57 +0900   <span class="m">0</span>
<span class="m">38658</span>   <span class="m">57520977797167422772945547576980778561</span>    photo/leo_rpc/ebin/leo_rpc_client_utils.beam                     <span class="m">0</span>       <span class="m">2576</span>        <span class="m">1413348057512261</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:40:57 +0900   <span class="m">0</span>
<span class="m">69506</span>   <span class="m">187294034498591995039607573685274229706</span>   photo/leo_backend_db/src/leo_backend_db_server.erl               <span class="m">0</span>       <span class="m">13911</span>       <span class="m">1413348068031188</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:41:08 +0900   <span class="m">0</span>
<span class="m">83603</span>   <span class="m">316467020376888598364250682951088839795</span>   photo/leo_backend_db/test/leo_backend_db_api_prop.erl            <span class="m">0</span>       <span class="m">3507</span>        <span class="m">1413348068052219</span>   <span class="m">2014</span>-10-15 <span class="m">13</span>:41:08 +0900   <span class="m">1</span>
</pre></div>
</td></tr></table>

<p>The file is formatted as Tab Separated Values(TSV) except headers (head 3 lines of a file).
The detail of each column are described below.</p>
<table>
<thead>
<tr>
<th>Column Number</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>byte-wise Offset where the object is located in an AVS.</td>
</tr>
<tr>
<td>2</td>
<td>Address ID on RING (Distribute Hash Routing Table).</td>
</tr>
<tr>
<td>3</td>
<td>File Name.</td>
</tr>
<tr>
<td>4</td>
<td>The Number of Children in a File.</td>
</tr>
<tr>
<td>5</td>
<td>File Size in bytes.</td>
</tr>
<tr>
<td>6</td>
<td>Timestamp in Unix Time.</td>
</tr>
<tr>
<td>7</td>
<td>Timestamp in Local Time.</td>
</tr>
<tr>
<td>8</td>
<td>Flag (0/1) representing whether the object is removed.</td>
</tr>
</tbody>
</table>
<h2 id="recover-objects">Recover Objects<a class="headerlink" href="#recover-objects" title="Permanent link">&para;</a></h2>
<p>This section provides information about recover commands that can be used in order to recover inconsistencies in a LeoFS cluster according to failures.</p>
<h3 id="commands_1">Commands<a class="headerlink" href="#commands_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Shell</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>leofs-adm recover-file \&lt;file-path></td>
<td>Recover an inconsistent object specified by the file-path.</td>
</tr>
<tr>
<td>leofs-adm recover-node \&lt;storage-node></td>
<td>Recover all inconsistent objects in the specified storage-node.</td>
</tr>
<tr>
<td>leofs-adm recover-cluster \&lt;cluster-id></td>
<td>Recover all inconsistent objects in the specified cluster-id.</td>
</tr>
</tbody>
</table>
<p>Examples.</p>
<ul>
<li>recover-file</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm recover-file leo/fast/storage.key
OK
</pre></div>
</td></tr></table>

<ul>
<li>recover-node</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm recover-node storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<ul>
<li>recover-cluster</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ leofs-adm recover-cluster cluster-1
OK
</pre></div>
</td></tr></table>

<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<p>When/How to use recover commands.</p>
<ul>
<li>AVS/KVS Broken<ul>
<li>Invoke <code class="codehilite">recover-node</code> with a node having broken AVS/KVS files.</li>
</ul>
</li>
<li>Queue Broken<ul>
<li>Invoke <code class="codehilite">recover-node</code> with every node except which having broken Queue files.</li>
<li>The procedure might be improved in future when <a href="https://github.com/leo-project/leofs/issues/618">https://github.com/leo-project/leofs/issues/618</a> solved.</li>
</ul>
</li>
<li>Disk Broken<ul>
<li>Invoke <code class="codehilite">suspend</code> with a node having broken Disk arrays and subsequently run <code class="codehilite">leo_storage stop</code>.</li>
<li>Exchange broken Disk arrays.</li>
<li>Run <code class="codehilite">leo_storage start</code> and subsequently Invoke <code class="codehilite">resume</code> with the node.</li>
<li>Invoke <code class="codehilite">recover-node</code> with the node.</li>
</ul>
</li>
<li>Node Broken<ul>
<li>Invoke <code class="codehilite">detach</code> with a broken node.</li>
<li>Prepare a new node that will take over all objects assigned to a detached node.</li>
<li>Invoke <code class="codehilite">attach</code> with a new node.</li>
<li>Invoke <code class="codehilite">rebalance</code>.</li>
</ul>
</li>
<li>Source/Destination Cluster Down<ul>
<li>Invoke <code class="codehilite">recover-cluster</code> with a downed cluster.</li>
</ul>
</li>
<li>Source/Destination Cluster Down and delete operations on the other side got lost (compacted).<ul>
<li>Set up the cluster from scratch</li>
<li>invoke <code class="codehilite">recover-cluster</code> with the new cluster</li>
<li>See also <a href="https://github.com/leo-project/leofs/issues/636">https://github.com/leo-project/leofs/issues/636</a> for more information.</li>
</ul>
</li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cluster/" title="Cluster Operations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cluster Operations
              </span>
            </div>
          </a>
        
        
          <a href="../multi_dc_replication/" title="Multi Data Center Replication" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Multi Data Center Replication
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            (c) 2012-2017 LeoProject. All rights reserved.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>